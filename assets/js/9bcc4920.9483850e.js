"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[81567],{41310:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>a,default:()=>p,frontMatter:()=>l,metadata:()=>d,toc:()=>c});var s=n(74848),i=n(28453),r=n(94331);const l={title:"Add Provider To An Existing Command",sidebar_position:10,description:"This guide outlines the process for adding an endpoint to an existing data provider and router endpoint.",keywords:["OpenBB Platform","Open source","Python interface","REST API","contribution","contributing","documentation","code","provider","data","endpoint","existing","OpenBB extensions","OpenBB provider","standard model","provider model","how to"]},a=void 0,d={id:"platform/user_guides/add_data_to_existing_endpoint",title:"Add Provider To An Existing Command",description:"This guide outlines the process for adding an endpoint to an existing data provider and router endpoint.",source:"@site/content/platform/user_guides/add_data_to_existing_endpoint.mdx",sourceDirName:"platform/user_guides",slug:"/platform/user_guides/add_data_to_existing_endpoint",permalink:"/platform/user_guides/add_data_to_existing_endpoint",draft:!1,unlisted:!1,editUrl:"https://github.com/OpenBB-finance/OpenBBTerminal/edit/main/website/content/platform/user_guides/add_data_to_existing_endpoint.mdx",tags:[],version:"current",lastUpdatedBy:"montezdesousa",lastUpdatedAt:1716479339e3,sidebarPosition:10,frontMatter:{title:"Add Provider To An Existing Command",sidebar_position:10,description:"This guide outlines the process for adding an endpoint to an existing data provider and router endpoint.",keywords:["OpenBB Platform","Open source","Python interface","REST API","contribution","contributing","documentation","code","provider","data","endpoint","existing","OpenBB extensions","OpenBB provider","standard model","provider model","how to"]},sidebar:"tutorialSidebar",previous:{title:"Build New OBBject Extension",permalink:"/platform/user_guides/add_obbject_extension"},next:{title:"Add Command To An Existing Provider",permalink:"/platform/user_guides/add_endpoint_to_existing_provider"}},o={},c=[{value:"Identify What&#39;s Being Added",id:"identify-whats-being-added",level:2},{value:"Provider API Documentation",id:"provider-api-documentation",level:3},{value:"Base URL",id:"base-url",level:3},{value:"Source Parameters",id:"source-parameters",level:3},{value:"Source Response",id:"source-response",level:3},{value:"OpenBB Endpoint",id:"openbb-endpoint",level:3},{value:"Standard Model",id:"standard-model",level:3},{value:"Standard QueryParams",id:"standard-queryparams",level:3},{value:"Standard Data",id:"standard-data",level:3},{value:"Build the Provider Model",id:"build-the-provider-model",level:2},{value:"Create a New File",id:"create-a-new-file",level:3},{value:"Import Statements",id:"import-statements",level:3},{value:"Define The QueryParams",id:"define-the-queryparams",level:3},{value:"Define The Data Model",id:"define-the-data-model",level:3},{value:"Build the Fetcher Class",id:"build-the-fetcher-class",level:3},{value:"Map To Router",id:"map-to-router",level:2},{value:"Rebuild Static Assets",id:"rebuild-static-assets",level:2},{value:"Add Tests",id:"add-tests",level:2},{value:"Unit Tests",id:"unit-tests",level:3},{value:"Integration Tests",id:"integration-tests",level:3},{value:"Python Test",id:"python-test",level:4},{value:"API Test",id:"api-test",level:4},{value:"Submit A Pull Request",id:"submit-a-pull-request",level:2},{value:"Linters",id:"linters",level:3},{value:"Add Files To Commit",id:"add-files-to-commit",level:3},{value:"Install Pre-Commit Hooks",id:"install-pre-commit-hooks",level:3},{value:"Commit Changes",id:"commit-changes",level:3},{value:"Push Changes",id:"push-changes",level:3},{value:"Open a Pull Request",id:"open-a-pull-request",level:3},{value:"Enjoy",id:"enjoy",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.A,{title:"Add Provider To An Existing Command - How-To | OpenBB Platform Docs"}),"\n",(0,s.jsx)(t.p,{children:"This page will walk through adding a data provider to an existing endpoint, using a standard model. At a high level, the process will look something like:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Document the parameters and returned fields from the chosen data provider."}),"\n",(0,s.jsx)(t.li,{children:"Find the existing standard model that is mapped to the router endpoint."}),"\n",(0,s.jsx)(t.li,{children:"Identify any common parameters and fields to map."}),"\n",(0,s.jsx)(t.li,{children:"Build the provider models and Fetcher class by inheriting from the standard models."}),"\n",(0,s.jsx)(t.li,{children:"Map the new provider model to the router."}),"\n",(0,s.jsx)(t.li,{children:"Rebuild the Python interface and static assets."}),"\n",(0,s.jsx)(t.li,{children:"Add unit tests."}),"\n",(0,s.jsx)(t.li,{children:"Add integration tests."}),"\n",(0,s.jsx)(t.li,{children:"Submit a pull request."}),"\n"]}),"\n",(0,s.jsxs)(t.admonition,{type:"note",children:[(0,s.jsx)(t.p,{children:"Before getting started, get a few housekeeping items in order:"}),(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Clone the GitHub repo and navigate into the project's folder.","\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["If you have already done this, update your local branch:","\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"git fetch"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"git pull origin develop"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:['Install the OpenBB Platform in "editable" mode.',"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"cd openbb_platform"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"python dev_install.py -e"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["Rebuild the Python interface and static assets.","\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"import openbb"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"openbb.build()"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["Create a new local branch (pick a relevant name and use dashes for multiple words), always beginning with ",(0,s.jsx)(t.code,{children:"feature/"}),".","\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"git checkout -b feature/av-historical-eps"})}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,s.jsx)(t.p,{children:"Let's get started!"}),"\n",(0,s.jsx)(t.h2,{id:"identify-whats-being-added",children:"Identify What's Being Added"}),"\n",(0,s.jsxs)(t.p,{children:["For this example, we will be adding a user-requested data set from AlphaVantage, historical EPS. There is an existing ",(0,s.jsx)(t.a,{href:"https://github.com/OpenBB-finance/OpenBBTerminal/issues/6104",children:"GitHub issue"})," that we will link to in the submitted pull request. By linking the issue, it will be closed automatically on merge."]}),"\n",(0,s.jsx)(t.p,{children:"Here's what we know about this AlphaVantage API endpoint:"}),"\n",(0,s.jsx)(t.admonition,{type:"info",children:(0,s.jsx)(t.p,{children:"This API returns the annual and quarterly earnings (EPS) for the company of interest.\nQuarterly data also includes analyst estimates and surprise metrics."})}),"\n",(0,s.jsx)(t.h3,{id:"provider-api-documentation",children:"Provider API Documentation"}),"\n",(0,s.jsxs)(t.p,{children:["The documentation for this endpoint is, ",(0,s.jsx)(t.a,{href:"https://www.alphavantage.co/documentation/#earnings",children:"https://www.alphavantage.co/documentation/#earnings"}),". This link will be added to the query parameters model docstring."]}),"\n",(0,s.jsx)(t.h3,{id:"base-url",children:"Base URL"}),"\n",(0,s.jsxs)(t.p,{children:["The base URL structure will be different for each provider, AlphaVantage identifies a ",(0,s.jsx)(t.code,{children:"function"})," for each request as the first parameter."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'BASE_URL = "https://www.alphavantage.co/query?function=EARNINGS&"\n'})}),"\n",(0,s.jsx)(t.h3,{id:"source-parameters",children:"Source Parameters"}),"\n",(0,s.jsxs)(t.p,{children:["Ignoring ",(0,s.jsx)(t.code,{children:"function"})," and ",(0,s.jsx)(t.code,{children:"api_key"}),", there is only one parameter for this function."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'symbol: str = "IBM"\n'})}),"\n",(0,s.jsx)(t.h3,{id:"source-response",children:"Source Response"}),"\n",(0,s.jsx)(t.p,{children:"They provide a sample JSON output, returning both annual and quarterly data in the same response."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:'{\n  "symbol": "IBM",\n  "annualEarnings": [\n    {\n      "fiscalDateEnding": "2023-12-31",\n      "reportedEPS": "9.61"\n    },\n    {\n      "fiscalDateEnding": "2022-12-31",\n      "reportedEPS": "9.12"\n    }\n  ],\n  "quarterlyEarnings": [\n    {\n      "fiscalDateEnding": "2023-12-31",\n      "reportedDate": "2024-01-24",\n      "reportedEPS": "3.87",\n      "estimatedEPS": "3.78",\n      "surprise": "0.09",\n      "surprisePercentage": "2.381"\n    },\n    {\n      "fiscalDateEnding": "2023-09-30",\n      "reportedDate": "2023-10-25",\n      "reportedEPS": "2.2",\n      "estimatedEPS": "2.13",\n      "surprise": "0.07",\n      "surprisePercentage": "3.2864"\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(t.p,{children:"Here's what we know about the existing router endpoint and standard model:"}),"\n",(0,s.jsx)(t.h3,{id:"openbb-endpoint",children:"OpenBB Endpoint"}),"\n",(0,s.jsx)(t.p,{children:"The function we are adding AlphaVantage as a source to is:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'from openbb import obb\n\nobb.equity.fundamental.historical_eps(symbol = "IBM", limit=5, provider="fmp")\n'})}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"date"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"symbol"}),(0,s.jsx)(t.th,{style:{textAlign:"right"},children:"eps_actual"}),(0,s.jsx)(t.th,{style:{textAlign:"right"},children:"eps_estimated"}),(0,s.jsx)(t.th,{style:{textAlign:"right"},children:"revenue_estimated"}),(0,s.jsx)(t.th,{style:{textAlign:"right"},children:"revenue_actual"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"reporting_time"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"updated_at"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"period_ending"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-01-24"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"IBM"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"3.87"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"3.78"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"17298500000"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"17381000000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"amc"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-02-29"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2023-12-31"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-04-17"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"IBM"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"-"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"1.59"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"14572800000"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"-"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"bmo"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-02-29"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-03-30"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-07-24"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"IBM"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"-"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"-"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"-"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"-"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"amc"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-02-29"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-06-30"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-10-23"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"IBM"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"-"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"-"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"-"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"-"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"amc"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-02-29"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-09-30"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2025-01-22"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"IBM"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"-"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"-"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"-"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"-"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"amc"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-02-29"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-12-31"})]})]})]}),"\n",(0,s.jsxs)(t.p,{children:["FMP is currently the only source for this endpoint. There are only two parameters, ",(0,s.jsx)(t.code,{children:"symbol"})," and ",(0,s.jsx)(t.code,{children:"limit"}),". The ",(0,s.jsx)(t.code,{children:"limit"})," argument determines how many quarters to go back."]}),"\n",(0,s.jsx)(t.h3,{id:"standard-model",children:"Standard Model"}),"\n",(0,s.jsxs)(t.p,{children:["The standard model is defined by, ",(0,s.jsx)(t.a,{href:"https://docs.openbb.co/platform/data_models/HistoricalEps",children:"HistoricalEps"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"from openbb_core.provider.standard_models.historical_eps import HistoricalEpsData, HistoricalEpsQueryParams\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Each standard model consists of two classes, ",(0,s.jsx)(t.code,{children:"QueryParams"})," and ",(0,s.jsx)(t.code,{children:"Data"}),". The name of each model begins with a CamelCase representation of the endpoint, ",(0,s.jsx)(t.code,{children:"HistoricalEps"}),", with some instances warranting abbreviations. Files are always named with lower snake_case."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"HistoricalEps"})," is what we will reference in the router when we get there."]}),"\n",(0,s.jsx)(t.h3,{id:"standard-queryparams",children:"Standard QueryParams"}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"HistoricalEpsQueryParams"})," model defines only one parameter, ",(0,s.jsx)(t.code,{children:"symbol"}),". It includes a validation method for converting the symbol to upper case."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'class HistoricalEpsQueryParams(QueryParams):\n    """Historical EPS Query."""\n\n    symbol: str = Field(description=QUERY_DESCRIPTIONS.get("symbol", ""))\n\n    @field_validator("symbol", mode="before", check_fields=False)\n    @classmethod\n    def upper_symbol(cls, v: str) -> str:\n        """Convert symbol to uppercase."""\n        return v.upper()\n'})}),"\n",(0,s.jsxs)(t.p,{children:["We will inherit from this class to create our QueryParams model, specific to AlphaVantage. The model will be named, ",(0,s.jsx)(t.code,{children:"AlphaVantageHistoricalEpsQueryParams"}),". Don't worry about it being too long."]}),"\n",(0,s.jsx)(t.h3,{id:"standard-data",children:"Standard Data"}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"HistoricalEpsData"})," model defines some fields, with two being mandatory: ",(0,s.jsx)(t.code,{children:"date"})," and ",(0,s.jsx)(t.code,{children:"symbol"}),". It includes a validation method for converting the date from an ISO string to a datetime object."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'class HistoricalEpsData(Data):\n    """Historical EPS Data."""\n\n    date: dateType = Field(default=None, description=DATA_DESCRIPTIONS.get("date", ""))\n    symbol: str = Field(description=DATA_DESCRIPTIONS.get("symbol", ""))\n    announce_time: Optional[str] = Field(\n        default=None, description="Timing of the earnings announcement."\n    )\n    eps_actual: Optional[float] = Field(\n        default=None, description="Actual EPS from the earnings date."\n    )\n    eps_estimated: Optional[float] = Field(\n        default=None, description="Estimated EPS for the earnings date."\n    )\n\n    @field_validator("date", mode="before", check_fields=False)\n    def date_validate(cls, v):  # pylint: disable=E0213\n        """Return formatted datetime."""\n        return parser.isoparse(str(v))\n'})}),"\n",(0,s.jsx)(t.p,{children:"Now we know exactly what is going to be added, and how we should structure our query to fetch the data. This endpoint is not overly complex but harmonizing many input parameters, and the potentially endless data fields, across many providers is a challenge."}),"\n",(0,s.jsx)(t.p,{children:"So far, we have knocked out three of the outlined tasks."}),"\n",(0,s.jsxs)(t.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(t.li,{className:"task-list-item",children:[(0,s.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Catalogue the parameters and returned fields from the chosen data provider."]}),"\n",(0,s.jsxs)(t.li,{className:"task-list-item",children:[(0,s.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Find the existing standard model that is mapped to the router endpoint."]}),"\n",(0,s.jsxs)(t.li,{className:"task-list-item",children:[(0,s.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Identify common parameters and fields to map."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Let's get on with the fun stuff and start building!"}),"\n",(0,s.jsx)(t.h2,{id:"build-the-provider-model",children:"Build the Provider Model"}),"\n",(0,s.jsx)(t.h3,{id:"create-a-new-file",children:"Create a New File"}),"\n",(0,s.jsx)(t.p,{children:"The first step is to create a new file in the provider extension folder:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-console",children:"~/OpenBBTerminal/openbb_platform/providers/alpha_vantage/openbb_alpha_vantage/models\n"})}),"\n",(0,s.jsxs)(t.p,{children:["We will call this file: ",(0,s.jsx)(t.code,{children:"historical_eps.py"})]}),"\n",(0,s.jsx)(t.p,{children:"The first line of the file should be a docstring, followed by the import statements."}),"\n",(0,s.jsx)(t.h3,{id:"import-statements",children:"Import Statements"}),"\n",(0,s.jsxs)(t.p,{children:["Every model will be different, but most items below will be typical of nearly every data provider model. Variations will come from design choices for ",(0,s.jsx)(t.a,{href:"/platform/developer_guide/http_requests",children:"HTTP requests"}),", or other requirements. We won't get into that here though."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'"""AlphaVantage Historical EPS Model."""\n\n# pylint: disable=unused-argument\n\nfrom datetime import date as dateType\nfrom typing import Any, Dict, List, Literal, Optional\nfrom warnings import warn\n\nfrom openbb_core.provider.abstract.fetcher import Fetcher\nfrom openbb_core.provider.standard_models.historical_eps import (\n    HistoricalEpsData,\n    HistoricalEpsQueryParams,\n)\nfrom openbb_core.provider.utils.descriptions import QUERY_DESCRIPTIONS\nfrom openbb_core.provider.utils.errors import EmptyDataError\nfrom openbb_core.provider.utils.helpers import (\n    ClientResponse,\n    ClientSession,\n    amake_requests\n)\nfrom pydantic import Field, field_validator\n'})}),"\n",(0,s.jsx)(t.h3,{id:"define-the-queryparams",children:"Define The QueryParams"}),"\n",(0,s.jsxs)(t.p,{children:["Define a class that inherits from the standard model's ",(0,s.jsx)(t.code,{children:"QueryParams"})," and put a link to the source documentation, if it exists, in the docstring."]}),"\n",(0,s.jsxs)(t.p,{children:["We'll define a field to return either, ",(0,s.jsx)(t.code,{children:"annualEarnings"})," or ",(0,s.jsx)(t.code,{children:"quarterlyEarnings"}),". Other endpoints call this parameter ",(0,s.jsx)(t.code,{children:"period"}),", so we will do the same here. Adding a ",(0,s.jsx)(t.code,{children:"limit"})," parameter will provide more flexibility, even though we can't control that from the source."]}),"\n",(0,s.jsxs)(t.p,{children:["If a parameter is common, like ",(0,s.jsx)(t.code,{children:"date"})," or ",(0,s.jsx)(t.code,{children:"period"})," are, they will have a standardized description. The ",(0,s.jsx)(t.code,{children:"description"})," will display in the function's signature and Fast API Swagger docs."]}),"\n",(0,s.jsxs)(t.p,{children:["To allow multiple items in a query parameters field - i.e, a list of tickers - we can add the ",(0,s.jsx)(t.code,{children:"__json_schema_extra__"})," dictionary to the top of the model. If there are any fields to map on output, define them with the ",(0,s.jsx)(t.code,{children:"__alias_dict__"})," dictionary."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'class AlphaVantageHistoricalEpsQueryParams(HistoricalEpsQueryParams):\n    """\n    AlphaVantage Historical EPS Query Params.\n\n    Source: https://www.alphavantage.co/documentation/#earnings\n    """\n\n    __json_schema_extra__ = {"symbol": ["multiple_items_allowed"]}\n\n    period: Literal["annual", "quarter"] = Field(\n        default="quarter", description=QUERY_DESCRIPTIONS.get("period", "")\n    )\n    limit: Optional[int] = Field(\n        default=None, description=QUERY_DESCRIPTIONS.get("limit", "")\n    )\n'})}),"\n",(0,s.jsx)(t.h3,{id:"define-the-data-model",children:"Define The Data Model"}),"\n",(0,s.jsxs)(t.p,{children:["In the sample output data from AlphaVantage, we know that there are two date fields; however, only 'fiscalDateEnding' is returned in both time intervals. This makes it the right candidate to map to the ",(0,s.jsx)(t.code,{children:"date"})," field in the standard model."]}),"\n",(0,s.jsxs)(t.p,{children:["Mapping is done via ",(0,s.jsx)(t.code,{children:"__alias_dict__"}),", a dictionary defined at the top of the class before any fields. Leave it out if there's nothing to map."]}),"\n",(0,s.jsxs)(t.admonition,{type:"tip",children:[(0,s.jsx)(t.p,{children:"If a field represents a percent, we want to always return it as a normalized decimal value - i.e, 1% is 0.01 - so that downstream processes can use values directly in formulas without needing to figure out if 1 means 1% or 100%."}),(0,s.jsxs)(t.p,{children:["If the data source returns the numbers (or null values) as a string (maybe with a % character), we will clean it using a ",(0,s.jsx)(t.code,{children:"field_validator"}),"."]}),(0,s.jsxs)(t.p,{children:["We communicate this to the frontend, via ",(0,s.jsx)(t.code,{children:"json_schema_extra"}),", in the field definition so the values can be correctly displayed."]}),(0,s.jsx)(t.p,{children:"By ensuring this small detail, we contribute to the overall standardization of data."})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'class AlphaVantageHistoricalEpsData(HistoricalEpsData):\n    """AlphaVantage Historical EPS Data."""\n\n    __alias_dict__ = {\n        "date": "fiscalDateEnding",\n        "eps_actual": "reportedEPS",\n        "eps_estimated": "estimatedEPS",\n        "surprise_percent": "surprisePercentage",\n        "reported_date": "reportedDate",\n    }\n\n    surprise: Optional[float] = Field(\n        default=None,\n        description="Surprise in EPS (Actual - Estimated).",\n    )\n    surprise_percent: Optional[float] = Field(\n        default=None,\n        description="EPS surprise as a normalized percent.",\n        json_schema_extra={"x-unit_measurement": "percent", "x-frontend_multiply": 100},\n    )\n    reported_date: Optional[dateType] = Field(\n        default=None,\n        description="Date of the earnings report.",\n    )\n\n    @field_validator(\n        "eps_estimated",\n        "eps_actual",\n        "surprise",\n        mode="before",\n        check_fields=False,\n    )\n    @classmethod\n    def validate_null(cls, v):\n        """Clean None returned as a string."""\n        return None if str(v).strip() == "None" or str(v) == "0" else v\n\n    @field_validator("surprise_percent", mode="before", check_fields=False)\n    @classmethod\n    def normalize_percent(cls, v):\n        """Normalize percent values."""\n        if isinstance(v, str) and v == "None" or str(v) == "0":\n            return None\n        return float(v) / 100\n'})}),"\n",(0,s.jsx)(t.h3,{id:"build-the-fetcher-class",children:"Build the Fetcher Class"}),"\n",(0,s.jsxs)(t.p,{children:["Provider models have a total of three classes, ",(0,s.jsx)(t.code,{children:"QueryParams"}),", ",(0,s.jsx)(t.code,{children:"Data"}),", and ",(0,s.jsx)(t.code,{children:"Fetcher"}),". The ",(0,s.jsx)(t.code,{children:"Fetcher"})," is what gets executed by the router and divides the request into three distinct processes that can be serviced individually. We define it as a Transform-Extract-Transform (TET) process because we:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Transform the query from the user input into the specific format required for each provider."}),"\n",(0,s.jsx)(t.li,{children:"Extract the data from the provider endpoint."}),"\n",(0,s.jsx)(t.li,{children:"Transform the data into a standard format (the model or a list of models)."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Each process is a static method, and breaking it down makes it easier to debug any points of failure."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'class AVHistoricalEpsFetcher(\n    Fetcher[\n        AlphaVantageHistoricalEpsQueryParams,\n        List[AlphaVantageHistoricalEpsData]\n    ]\n):\n    """AlphaVantage Historical EPS Fetcher."""\n\n    @staticmethod\n    def transform_query(params: Dict[str, Any]) -> AlphaVantageHistoricalEpsQueryParams:\n        """Transform the query params."""\n        # If no transformations are required, simply return the validated model.\n        return AlphaVantageHistoricalEpsQueryParams(**params)\n\n    @staticmethod\n    async def aextract_data(\n        query: AlphaVantageHistoricalEpsQueryParams,\n        credentials: Optional[Dict[str, str]],\n        **kwargs: Any,\n    ) -> List[Dict]:\n        """Return the raw data from the AlphaVantage endpoint."""\n\n        api_key = credentials.get("alpha_vantage_api_key") if credentials else "DEMO"\n\n        BASE_URL = "https://www.alphavantage.co/query?function=EARNINGS&"\n\n        # We are allowing multiple symbols to be passed in the query, so we need to handle that.\n        symbols = query.symbol.split(",")\n\n        urls = [\n            f"{BASE_URL}symbol={symbol}&apikey={api_key}" for symbol in symbols\n        ]\n\n        results = []\n\n        # We need to make a custom callback function for this async request.\n        async def response_callback(response: ClientResponse, _: ClientSession):\n            """Response callback function."""\n            symbol = response.url.query.get("symbol", None)\n            data = await response.json()\n            target = "annualEarnings" if query.period == "annual" else "quarterlyEarnings"\n            result = []\n            # If data is returned, append it to the results list.\n            if data:\n                result = [\n                    {\n                        "symbol": symbol,\n                        **d,\n                    }\n                    for d in data.get(target, [])  # type: ignore\n                ]\n                if query.limit is not None:\n                    results.extend(result[:query.limit])\n                else:\n                    results.extend(result)\n\n            # If no data is returned, raise a warning and move on to the next symbol.\n            if not data:\n                warn(f"Symbol Error: No data found for {symbol}")\n\n        await amake_requests(urls, response_callback, **kwargs)  # type: ignore\n\n        return results\n\n    @staticmethod\n    def transform_data(\n        query: AlphaVantageHistoricalEpsQueryParams,\n        data: List[Dict],\n        **kwargs: Any,\n    ) -> List[AlphaVantageHistoricalEpsData]:\n        """Transform the raw data into the standard model."""\n        if not data:\n            raise EmptyDataError("No data found.")\n        return [AlphaVantageHistoricalEpsData.model_validate(d) for d in data]\n'})}),"\n",(0,s.jsx)(t.p,{children:"Combining all of the code blocks above, beginning with the import statements section, makes a complete file and we have finished step 4."}),"\n",(0,s.jsxs)(t.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(t.li,{className:"task-list-item",children:[(0,s.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Build the provider models and Fetcher class by inheriting from the standard models."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"map-to-router",children:"Map To Router"}),"\n",(0,s.jsxs)(t.p,{children:["Mapping to the router is done in the ",(0,s.jsx)(t.code,{children:"__init__.py"})," file, one folder back from the ",(0,s.jsx)(t.code,{children:"models"})," folder where we created the ",(0,s.jsx)(t.code,{children:"historical_eps.py"})," file."]}),"\n",(0,s.jsxs)(t.p,{children:["We import the ",(0,s.jsx)(t.code,{children:"Fetcher"})," that was created, and then map it in the ",(0,s.jsx)(t.code,{children:"fetcher_dict"})," property of the Provider class."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'"""Alpha Vantage Provider module."""\n\nfrom openbb_alpha_vantage.models.equity_historical import AVEquityHistoricalFetcher\nfrom openbb_alpha_vantage.models.historical_eps import AVHistoricalEpsFetcher\nfrom openbb_core.provider.abstract.provider import Provider\n\nalpha_vantage_provider = Provider(\n    name="alpha_vantage",\n    website="https://www.alphavantage.co/documentation/",\n    description="""Alpha Vantage provides realtime and historical\n    financial market data through a set of powerful and developer-friendly data APIs\n    and spreadsheets. From traditional asset classes (e.g., stocks, ETFs, mutual funds)\n    to economic indicators, from foreign exchange rates to commodities,\n    from fundamental data to technical indicators, Alpha Vantage\n    is your one-stop-shop for enterprise-grade global market data delivered through\n    cloud-based APIs, Excel, and Google Sheets. """,\n    credentials=["api_key"],\n    fetcher_dict={\n        "EquityHistorical": AVEquityHistoricalFetcher,\n        "HistoricalEps": AVHistoricalEpsFetcher,\n    },\n)\n'})}),"\n",(0,s.jsx)(t.p,{children:"Step 5 is complete."}),"\n",(0,s.jsxs)(t.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(t.li,{className:"task-list-item",children:[(0,s.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Map the new provider model to the router."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"rebuild-static-assets",children:"Rebuild Static Assets"}),"\n",(0,s.jsxs)(t.p,{children:["When modifying router components or model definitions, the Python interface needs to be rebuilt before use. Open a terminal, with the ",(0,s.jsx)(t.code,{children:"obb"})," environment active, start a new Python session, and enter:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"import openbb\n\nopenbb.build()\n\nexit()\n"})}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsx)(t.p,{children:"If changes are only made to the static methods within the Fetcher, rebuilding is not required. Restart the Python interpreter to apply the edits."})}),"\n",(0,s.jsx)(t.p,{children:"Step 6 is done."}),"\n",(0,s.jsxs)(t.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(t.li,{className:"task-list-item",children:[(0,s.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Rebuild the Python interface and static assets."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"We can now run the function and test our work."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'from openbb import obb\n\nobb.equity.fundamental.historical_eps(\n    symbol=["IBM","GOOG","AAPL","MSFT"],\n    period="quarter",\n    provider="alpha_vantage",\n    limit=1\n).to_df()\n'})}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"date"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"symbol"}),(0,s.jsx)(t.th,{style:{textAlign:"right"},children:"eps_actual"}),(0,s.jsx)(t.th,{style:{textAlign:"right"},children:"eps_estimated"}),(0,s.jsx)(t.th,{style:{textAlign:"right"},children:"surprise"}),(0,s.jsx)(t.th,{style:{textAlign:"right"},children:"surprise_percent"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"reported_date"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2023-12-31"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"GOOG"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"1.64"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"1.59"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"0.05"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"0.031447"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-01-30"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2023-12-31"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"AAPL"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"2.18"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"2.1"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"0.08"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"0.038095"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-02-01"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2023-12-31"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"MSFT"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"2.93"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"2.78"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"0.15"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"0.053957"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-01-30"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2023-12-31"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"IBM"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"3.87"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"3.78"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"0.09"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"0.02381"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2024-01-24"})]})]})]}),"\n",(0,s.jsxs)(t.p,{children:["Checking the ",(0,s.jsx)(t.code,{children:"annual"})," setting:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'obb.equity.fundamental.historical_eps(\n    symbol="AAPL,\n    period="annual",\n    provider="alpha_vantage",\n    limit=4\n).to_df()\n'})}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"date"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"symbol"}),(0,s.jsx)(t.th,{style:{textAlign:"right"},children:"eps_actual"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2021-09-30"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"AAPL"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"5.62"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2022-09-30"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"AAPL"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"6.11"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2023-09-30"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"AAPL"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"6.12"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2023-12-31"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"AAPL"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"2.18"})]})]})]}),"\n",(0,s.jsxs)(t.p,{children:["We can see that the most recent ",(0,s.jsx)(t.code,{children:"annual"})," data point only represent the first quarter of Apple's fiscal year, and this is something to keep in mind while working with the data."]}),"\n",(0,s.jsx)(t.p,{children:"To check that the warning is being transmitted, enter a bad symbol in the list."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'obb.equity.fundamental.historical_eps(symbol="AAPL,BAD_SYMBOL", provider="alpha_vantage").warnings\n'})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-console",children:"[Warning_(category='UserWarning', message='Symbol Error: No data found for BAD_SYMBOL')]\n"})}),"\n",(0,s.jsx)(t.p,{children:"With confidence that the endpoint is working as expected, let's move on to unit and integration tests."}),"\n",(0,s.jsx)(t.h2,{id:"add-tests",children:"Add Tests"}),"\n",(0,s.jsx)(t.p,{children:"Adding tests doesn't take a lot of effort. In most cases, copying and pasting from an existing one will do the job."}),"\n",(0,s.jsx)(t.h3,{id:"unit-tests",children:"Unit Tests"}),"\n",(0,s.jsx)(t.p,{children:"Unit tests are located in the provider extension folder."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-console",children:"~/OpenBBTerminal/openbb_platform/providers/alpha_vantage/tests\n"})}),"\n",(0,s.jsx)(t.p,{children:"There will be one test file dedicated to testing each fetcher in the provider extension. Our file is:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-console",children:"test_alpha_vantage_fetchers.py\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The unit tests leverage the Fetcher class' built-in testing methods. It checks that the data is being returned, that types are conformed to their definitions, and that the model validates. It relies on ",(0,s.jsx)(t.code,{children:"pytest"})," and captures a HTTP cassette. Here's what our test file will look like:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'from datetime import date\n\nimport pytest\nfrom openbb_alpha_vantage.models.equity_historical import AVEquityHistoricalFetcher\nfrom openbb_alpha_vantage.models.historical_eps import AVHistoricalEpsFetcher\nfrom openbb_core.app.service.user_service import UserService\n\ntest_credentials = UserService().default_user_settings.credentials.model_dump(\n    mode="json"\n)\n\n\n@pytest.fixture(scope="module")\ndef vcr_config():\n    return {\n        "filter_headers": [("User-Agent", None)],\n        "filter_query_parameters": [\n            ("apikey", "MOCK_API_KEY"),\n        ],\n    }\n\n\n@pytest.mark.record_http\ndef test_av_equity_historical_fetcher(credentials=test_credentials):\n    params = {\n        "symbol": "AAPL",\n        "start_date": date(2023, 1, 1),\n        "end_date": date(2023, 1, 10),\n        "interval": "15m",\n    }\n\n    fetcher = AVEquityHistoricalFetcher()\n    result = fetcher.test(params, credentials)\n    assert result is None\n\n\n@pytest.mark.record_http\ndef test_av_historical_eps_fetcher(credentials=test_credentials):\n    params = {\n        "symbol": "AAPL,MSFT",\n        "period": "quarter",\n        "limit": 4\n    }\n\n    fetcher = AVHistoricalEpsFetcher()\n    result = fetcher.test(params, credentials)\n    assert result is None\n'})}),"\n",(0,s.jsxs)(t.p,{children:["That's all there is to it, we can capture the cassette now. Open a terminal, navigate into the ",(0,s.jsx)(t.code,{children:"tests"})," folder from above, with the ",(0,s.jsx)(t.code,{children:"obb"})," environment active, and enter:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-console",children:"pytest test_alpha_vantage_fetchers.py --record http --record-no-overwrite\n"})}),"\n",(0,s.jsxs)(t.p,{children:["A successful test will result in a file being created in the ",(0,s.jsx)(t.code,{children:"record"})," subfolder. Check the file for any obvious errors."]}),"\n",(0,s.jsx)(t.p,{children:"Step 7 is done."}),"\n",(0,s.jsxs)(t.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(t.li,{className:"task-list-item",children:[(0,s.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Add unit tests."]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"integration-tests",children:"Integration Tests"}),"\n",(0,s.jsxs)(t.p,{children:["Integration tests are even easier to add here, we just need to add a set of parameters for the new provider to the existing test. These tests are located in the ",(0,s.jsx)(t.code,{children:"extensions"})," folder, where the routers are, under ",(0,s.jsx)(t.code,{children:"integration"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-console",children:"~/OpenBBTerminal/openbb_platform/extensions/equity/integration\n"})}),"\n",(0,s.jsx)(t.p,{children:"There are two files here, one for the Python interface, and the other for the Fast API."}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"test_equity_python.py"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"test_equity_api.py"})}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["There will be at least one test for every router endpoint, which expects all providers and parameters to be supplied. The structure will be the same for all functions. Snippets below will include the import statements, setup, and our function - ",(0,s.jsx)(t.code,{children:"historical_eps"}),"."]}),"\n",(0,s.jsx)(t.h4,{id:"python-test",children:"Python Test"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'"""Python interface integration tests for the equity extension."""\n\nfrom datetime import time\n\nimport pytest\nfrom extensions.tests.conftest import parametrize\nfrom openbb_core.app.model.obbject import OBBject\n\n# pylint: disable=too-many-lines,redefined-outer-name\n\n\n# pylint: disable=import-outside-toplevel,inconsistent-return-statements\n@pytest.fixture(scope="session")\ndef obb(pytestconfig):\n    """Fixture to setup obb."""\n    if pytestconfig.getoption("markexpr") != "not integration":\n        import openbb\n\n        return openbb.obb\n\n@parametrize(\n    "params",\n    [\n        ({"symbol": "AAPL", "limit": 5, "provider": "fmp"}),\n        (\n            {\n                "symbol": "AAPL",\n                "period": "quarter",\n                "limit": 5,\n                "provider": "alpha_vantage"\n            }\n        ),\n    ],\n)\n@pytest.mark.integration\ndef test_equity_fundamental_historical_eps(params, obb):\n    params = {p: v for p, v in params.items() if v}\n\n    result = obb.equity.fundamental.historical_eps(**params)\n    assert result\n    assert isinstance(result, OBBject)\n    assert len(result.results) > 0\n'})}),"\n",(0,s.jsx)(t.p,{children:"Run this test by navigating into the folder above and entering:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-console",children:"pytest test_equity_python.py\n"})}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsx)(t.p,{children:"If tests not related to the items being touched directly are failing, don't worry about them. That's out of scope."})}),"\n",(0,s.jsx)(t.h4,{id:"api-test",children:"API Test"}),"\n",(0,s.jsxs)(t.p,{children:["The API test is slightly different, but the ",(0,s.jsx)(t.code,{children:"params"})," can be copied and pasted from the Python test. In addition to basic checks, it will fail when values returned are not JSON serializable."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'"""API integration tests for equity extension."""\n\nimport base64\nfrom datetime import time\n\nimport pytest\nimport requests\nfrom extensions.tests.conftest import parametrize\nfrom openbb_core.env import Env\nfrom openbb_core.provider.utils.helpers import get_querystring\n\n# pylint: disable=too-many-lines,redefined-outer-name\n\n\n@pytest.fixture(scope="session")\ndef headers():\n    userpass = f"{Env().API_USERNAME}:{Env().API_PASSWORD}"\n    userpass_bytes = userpass.encode("ascii")\n    base64_bytes = base64.b64encode(userpass_bytes)\n\n    return {"Authorization": f"Basic {base64_bytes.decode(\'ascii\')}"}\n\n\n@parametrize(\n    "params",\n    [\n        ({"symbol": "AAPL", "limit": 5, "provider": "fmp"}),\n        (\n            {\n                "symbol": "AAPL",\n                "period": "quarter",\n                "limit": 5,\n                "provider": "alpha_vantage"\n            }\n        ),\n    ],\n)\n@pytest.mark.integration\ndef test_equity_fundamental_historical_eps(params, headers):\n    params = {p: v for p, v in params.items() if v}\n\n    query_str = get_querystring(params, [])\n    url = f"http://0.0.0.0:8000/api/v1/equity/fundamental/historical_eps?{query_str}"\n    result = requests.get(url, headers=headers, timeout=10)\n    assert isinstance(result, requests.Response)\n    assert result.status_code == 200\n'})}),"\n",(0,s.jsx)(t.p,{children:"To run this test, we will need to open a second terminal and start the server."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-console",children:"uvicorn openbb_core.api.rest_api:app\n"})}),"\n",(0,s.jsx)(t.p,{children:"Go back to the other terminal and run the test by entering:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-console",children:"pytest test_equity_api.py\n"})}),"\n",(0,s.jsx)(t.p,{children:"Step 8 is done."}),"\n",(0,s.jsxs)(t.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(t.li,{className:"task-list-item",children:[(0,s.jsx)(t.input,{type:"checkbox",checked:!0,disabled:!0})," ","Add integration tests."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"All that's left now is to submit the work as a pull request for review."}),"\n",(0,s.jsx)(t.h2,{id:"submit-a-pull-request",children:"Submit A Pull Request"}),"\n",(0,s.jsxs)(t.p,{children:["We're already on the correct branch, ",(0,s.jsx)(t.code,{children:"feature/av-historical-eps"}),", but it may be out-of-sync with the ",(0,s.jsx)(t.code,{children:"develop"})," branch. Let's update it just to be sure."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-console",children:"git fetch\ngit pull origin develop\n"})}),"\n",(0,s.jsx)(t.h3,{id:"linters",children:"Linters"}),"\n",(0,s.jsx)(t.p,{children:"Before opening a pull request, run the linters over all files that were touched."}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"black"}),"\n",(0,s.jsx)(t.li,{children:"ruff"}),"\n",(0,s.jsx)(t.li,{children:"mypy"}),"\n",(0,s.jsx)(t.li,{children:"pylint"}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["Fix all items, and valid fixes for ",(0,s.jsx)(t.code,{children:"pylint"})," can be disabling on that line. It won't always know what is contextually correct."]}),"\n",(0,s.jsx)(t.h3,{id:"add-files-to-commit",children:"Add Files To Commit"}),"\n",(0,s.jsx)(t.p,{children:"When preparing to commit changes to the local branch, only add the files directly touched. Here are all the files we touched in this process:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"openbb_platform/providers/alpha_vantage/openbb_alpha_vantage/models/historical_eps.py"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"openbb_platopenbb_platform/providers/alpha_vantage/openbb_alpha_vantage/__init__.py"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"openbb_platform/providers/alpha_vantage/tests/test_alpha_vantage_fetchers.py"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"openbb_platform/providers/alpha_vantage/tests/record/test_av_historical_eps_fetchers.yaml"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"openbb_platform/extensions/equity/integration/test_equity_api.py"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"openbb_platform/extensions/equity/integration/test_equity_python.py"})}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"install-pre-commit-hooks",children:"Install Pre-Commit Hooks"}),"\n",(0,s.jsxs)(t.p,{children:["The pre-commit hooks will run the testing suite locally before the commit is made. Install them from the root of the GitHub project folder, ",(0,s.jsx)(t.code,{children:"OpenBBTerminal"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-console",children:"pre-commit install\n"})}),"\n",(0,s.jsx)(t.h3,{id:"commit-changes",children:"Commit Changes"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-console",children:'git commit -m "adds AlphaVantage to historical_eps"\n'})}),"\n",(0,s.jsx)(t.h3,{id:"push-changes",children:"Push Changes"}),"\n",(0,s.jsx)(t.p,{children:"Assuming the commit is successful, push the changes to the remote branch."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-console",children:"git push --set-upstream origin feature/av-historical-eps\n"})}),"\n",(0,s.jsx)(t.h3,{id:"open-a-pull-request",children:"Open a Pull Request"}),"\n",(0,s.jsx)(t.p,{children:"A pull request, in general, should have details on why the PR was created, what the changes are, what the impact is to existing users and infrastructure, how it was tested, and any other relevant information for reviewers and maintainers to consider."}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Why"}),"? (1-3 sentences or a bullet point list):"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"This PR is the result of a development documentation page created (not in this PR)."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Closes #6104, a user feature request."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"What"}),"? (1-3 sentences or a bullet point list):"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Adds AlphaVantage as a provider to ",(0,s.jsx)(t.code,{children:"obb.equity.fundamental.historical_eps()"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Impact"})," (1-2 sentences or a bullet point list):"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Is not a breaking change."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Does not introduce any changes other than adding the provider to this endpoint."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Testing Done"}),":"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Created unit test and integration tests."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Used a variety of symbols, single and lists, to check that the EmptyDataError and symbol warnings are catching correctly."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"enjoy",children:"Enjoy"}),"\n",(0,s.jsx)(t.p,{children:"With this final step, we have completed all the tasks outlined at the top of the page. Thank you for your contributions!"}),"\n",(0,s.jsxs)(t.p,{children:["This guide was based on a true story, see the pull request ",(0,s.jsx)(t.a,{href:"https://github.com/OpenBB-finance/OpenBBTerminal/pull/6155",children:"here"})]})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},94331:(e,t,n)=>{n.d(t,{A:()=>r});n(96540);var s=n(5260),i=n(74848);function r(e){let{title:t}=e;return(0,i.jsx)(s.A,{children:(0,i.jsx)("title",{children:t})})}},28453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>a});var s=n(96540);const i={},r=s.createContext(i);function l(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);